{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">My Profile</h2>

<section class="mb-4">
  <h4 class="mb-3">My Books</h4>
  <div class="row g-3">
    {% for b in my_books %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm">
        <img src="{{ b.image_url }}" class="card-img-top" alt="{{ b.title }}">
        <div class="card-body">
          <h5 class="card-title mb-1">{{ b.title }}</h5>
          <p class="text-muted mb-2">{{ b.author }} • {{ b.type }}</p>
          <form method="post" action="{{ url_for('update_status', book_id=b.id) }}" class="d-flex gap-2 align-items-center">
            <label class="form-label me-2 mb-0">Status</label>
            <select name="status" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
              <option value="available" {{ 'selected' if b.available else '' }}>Available</option>
              <option value="unavailable" {{ '' if b.available else 'selected' }}>Unavailable</option>
            </select>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<section class="mb-4">
  <h4 class="mb-3">My Wishlist</h4>
  <div class="row g-3">
    {% for w in wishlist %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm">
        <img src="{{ w.book.image_url }}" class="card-img-top" alt="{{ w.book.title }}">
        <div class="card-body">
          <h5 class="card-title mb-1">{{ w.book.title }}</h5>
          <p class="text-muted mb-2">{{ w.book.author }} • {{ w.book.type }}</p>
          <form method="post" action="{{ url_for('wishlist_toggle', book_id=w.book.id) }}">
            <button class="btn btn-outline-danger w-100" type="submit">Remove</button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<section>
  <h4 class="mb-3">My Chats</h4>
  {% if partners|length == 0 %}
    <p class="text-muted">No conversations yet.</p>
  {% else %}
  <div class="list-group">
    {% for p in partners %}
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" href="{{ url_for('chat', user_id=p.id) }}">
        <div>
          <div class="fw-semibold">{{ p.name }}</div>
          <div class="small text-muted">{{ p.last_text }}</div>
        </div>
        <span class="badge bg-secondary">{{ p.last_time.strftime('%d %b %Y %H:%M') }}</span>
      </a>
    {% endfor %}
  </div>
  {% endif %}
</section>
{% endblock %}
